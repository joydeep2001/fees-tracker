<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fees List</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link rel="stylesheet"
  href="style.css" type="text/css">
  </head>
  <body>
   
<!-- Modal -->
<div class="modal fade p-1" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="ss-modal" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div style="height: 80vh; width: 50vw;" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Payment ScreenShot</h5>
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Loading...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
  <table class="table table-striped">
    <thead class="bg-dark text-light sticky-top">
      <tr>
        <th scope="col">#</th>
        <th scope="col">Name</th>
        <th scope="col">Semester</th>
        <th scope="col">College</th>
        <th scope="col">Fees of Month</th>
        <th scope="col">Payment Mode</th>
        <th scope="col">Mobile No.</th>
        <th scope="col">Gurdian Mobile No.</th>
        <th scope="col">Payment Date and Time</th>
        <th scope="col">ScreenShot</th>
      </tr>
    </thead>
    <tbody>
      
        
    </tbody>
  </table>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
    <script>
      let cachedData = [];
      function showSSinModal(event) {
        const [targetEl] = cachedData.filter((fee) => fee._id === event.target.id);
        const modalBody = document.querySelector(".modal-body");
        modalBody.innerHTML = `<div class="loading"><img src=${targetEl.screenshotURL} height='inherit' width='inherit'></div>`
      } 
      async function getStudents() {
        const response = await fetch("http://localhost:3005/api/fees");
        console.log(response);
        if(response.ok && response.status === 200) {
          const data = await response.json();
          const tbody = document.querySelector('tbody');
          console.log(data);
          cachedData = data.fees;
          data.fees.forEach((fee, sl) => {
            const row = document.createElement('tr');

            row.innerHTML += `<th scope="row">${sl + 1}</th>`;
            row.innerHTML += `<td>${fee.name}</td>`;
            row.innerHTML += `<td>${fee.sem}</td>`;
            row.innerHTML += `<td>${fee.college}</td>`;
            row.innerHTML += `<td>${fee.feesMonth}</td>`;
            row.innerHTML += `<td>${fee.paymentMode}</td>`;
            row.innerHTML += `<td>${fee.mobile}</td>`;
            row.innerHTML += `<td>${fee.gurdianMobile}</td>`;
            row.innerHTML += `<td>${fee.timestamp}</td>`;
            row.innerHTML += `<td><button onclick=showSSinModal(event) id=${fee._id} type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModalLong">Show</button></td>`;
            tbody.appendChild(row);
          })
        }
        

    }
    getStudents();
    </script>
  </body>
</html>
