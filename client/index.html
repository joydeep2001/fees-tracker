<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" />
    <title>Semester Fees</title>
  </head>
  <body class="container-fluid" style="margin: 0; padding: 0">
    <nav class="navbar navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <img
            src="./img/mentordada.png"
            alt=""
            width="100"
            height="50"
            class="d-inline-block align-text-top"
          />
          <h1>Semester Fees</h1>
        </a>
      </div>
    </nav>
    <!-- svg icons -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none">
      <symbol id="check-circle-fill" fill="currentColor" viewBox="0 0 16 16">
        <path
          d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"
        />
      </symbol>
      <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
        <path
          d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"
        />
      </symbol>
      <symbol
        id="exclamation-triangle-fill"
        fill="currentColor"
        viewBox="0 0 16 16"
      >
        <path
          d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"
        />
      </symbol>
    </svg>

    <!-- please wait alert -->
    <div
      id="wait-alert"
      class="position-fixed h-100 w-100 top-0 left-0 d-none justify-content-center align-items-center"
      style="background-color: #000000a5"
    >
      <h2 class="mx-2 text-info">Please wait</h2>

      <div class="spinner-border text-info" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <!-- success alert -->
    <div
      id="success-alert"
      class="alert alert-success fixed-top h-100 w-100 d-none justify-content-center align-items-center"
      role="alert"
    >
      <img style="height: 150px; width: 200px" src="./img/check-green.gif" />
      <h2>Data uploaded successfully!</h2>
      <!-- <button onclick="close()" type="button" class="col-8 btn btn-success">
        CLose window
      </button> -->
    </div>

    <!-- fail alert -->
    <div
      id="fail-alert"
      class="row alert alert-danger fixed-top h-100 w-100 d-none justify-content-center align-items-center"
      role="alert"
    >
      <img
        src="./img/error.webp"
        class="col-6 ml-4"
        style="height: 150px; width: 200px"
      />
      <h2 class="col-6">Something went wrong! Please try again!!</h2>
      <button
        onclick="alerts.hideFail()"
        type="button"
        class="col-8 btn btn-danger"
      >
        Retry
      </button>
    </div>

    <form class="row g-3 p-5">
      <div class="col-md-6">
        <label for="name" class="form-label">Full name</label>
        <input
          type="text"
          class="form-control"
          id="name"
          aria-describedby="name-fb"
          required
        />
        <div id="name-fb" class="invalid-feedback"></div>
      </div>
      <div class="col-md-6">
        <label for="clg" class="form-label">College</label>
        <input
          type="text"
          class="form-control"
          id="clg"
          aria-describedby="clg-fb"
          required
        />
        <div id="clg-fb" class="invalid-feedback"></div>
      </div>
      <div class="col-md-4">
        <label for="sem" class="form-label">Semester</label>
        <input
          type="number"
          class="form-control"
          id="sem"
          aria-describedby="sem-fb"
          required
        />
        <div id="sem-fb" class="invalid-feedback"></div>
      </div>
      <div class="col-md-4">
        <label for="fees-month" class="form-label">Fees For The Month Of</label>
        <input
          type="month"
          class="form-control"
          id="fees-month"
          aria-describedby="fees-month-fb"
          required
        />
        <div id="fees-month-fb" class="invalid-feedback"></div>
      </div>

      <div class="col-md-4">
        <label for="payment-mode" class="form-label">Payment Mode</label>
        <input
          type="text"
          class="form-control"
          id="payment-mode"
          aria-describedby="payment-mode-fb"
          required
        />
        <div id="payment-mode-fb" class="invalid-feedback"></div>
      </div>
      <div class="col-md-6">
        <label for="phn-no" class="form-label">Student Phone Number</label>
        <input
          type="number"
          class="form-control"
          id="phn-no"
          aria-describedby="phn-no-fb"
          required
        />
        <div id="phn-no-fb" class="invalid-feedback"></div>
      </div>
      <div class="col-md-6">
        <label for="gurdian-phn-no" class="form-label"
          >Gurdian Phone Number</label
        >
        <input
          type="number"
          class="form-control"
          id="gurdian-phn-no"
          aria-describedby="gurdian-phn-no-fb"
          required
        />
        <div id="gurdian-phn-no-fb" class="invalid-feedback"></div>
      </div>
      <div class="col-md-12">
        <label for="ss" class="form-label">Screenshot of Payment</label>
        <input
          type="file"
          class="form-control"
          id="ss"
          aria-describedby="ss"
          required
        />
        <div id="ss-fb" class="invalid-feedback"></div>
      </div>
      <div class="col-12">
        <button id="submit" class="btn btn-primary" type="button">
          Submit form
        </button>
      </div>
    </form>
    <div class="row p-5"></div>
    <script type="text/javascript">
      const inputs = document.querySelectorAll("input");
      const [
        studentName,
        college,
        sem,
        feesMonth,
        paymentMode,
        mobile,
        gurdianMobile,
        screenshot,
      ] = inputs;
      const message = document.querySelector("#message");
      const messageBody = document.querySelector("#msg-body");
      const submit = document.querySelector("#submit");
      const alerts = {
        wait: document.querySelector("#wait-alert"),
        success: document.querySelector("#success-alert"),
        fail: document.querySelector("#fail-alert"),
        hideFail: function () {
          alerts.fail.classList.remove("d-flex");
          alerts.fail.classList.add("d-none");
        },
      };
    </script>
    <script>
      async function wrapFetch(url, options) {
        submit.disabled = true;
        alerts.wait.classList.remove("d-none");
        alerts.wait.classList.add("d-flex");
        alerts.fail.classList.add("d-none");
        alerts.success.classList.add("d-none");
        return fetch(url, options);
      }
      async function sendFeesData(data) {
        const URL = "/fees-tracker/api/fees/upload";
        const URL_TEST_SUCCESS = "/fees-tracker/api/test/success";
        const URL_TEST_FAIL = "/fees-tracker/api/test/fail";
        const URL_TEST_ISE = "/fees-tracker/api/test/ise";
        try {
          const response = await wrapFetch(URL, {
            method: "POST",
            mode: "cors",
            body: data,
          });
          //hiding please wait
          alerts.wait.classList.add("d-none");
          alerts.wait.classList.remove("d-flex");

          if (!response.ok) {
            submit.disabled = false;
            alerts.fail.innerHTML += response.status;
            alerts.fail.innerHTML += "<br>";
            alerts.fail.innerHTML += response.statusText;
            alerts.fail.innerHTML += "<br>";
            alerts.fail.innerHTML += response.url;
            alerts.fail.innerHTML += "<br>";
            alerts.fail.classList.remove("d-none");
            alerts.fail.classList.add("d-flex");

            return;
          }
          const responseData = await response.json();

          alerts.success.classList.remove("d-none");
          alerts.success.classList.add("d-flex");
        } catch (err) {
          console.log(err);
        }
      }
    </script>
    <script src="./js/validation.js"></script>
    <script>
      submit.addEventListener("click", (e) => {
        const data = new FormData();
        const validateForm = new ValidateForm();
        validateForm.validate();
        validateForm.showErrors();
        if (!validateForm.isValid) {
          return;
        }

        data.append("studentName", studentName.value);
        data.append("college", college.value);
        data.append("sem", sem.value);
        data.append("feesMonth", feesMonth.value);
        data.append("mobile", gurdianMobile.value);
        data.append("screenshot", screenshot.files[0]);
        data.append("gurdianMobile", gurdianMobile.value);
        data.append("paymentMode", paymentMode.value);

        sendFeesData(data);
      });
    </script>
  </body>
</html>
